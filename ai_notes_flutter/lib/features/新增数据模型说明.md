# 新增数据模型说明

## 概述

已成功添加了四个新的数据结构：`FlashcardSet`、`Flashcard`、`QuizSet`、`Quiz`。这些结构都包含了 `metadata` 字段（类型为 `Map<String, dynamic>`），可用于存储 note id 以及其他扩展信息。

## 文件结构

```
lib/features/
├── flashcards/
│   └── domain/
│       └── entities/
│           ├── flashcard_set.dart
│           ├── flashcard.dart
│           └── entities.dart (导出文件)
├── quiz/
│   └── domain/
│       └── entities/
│           ├── quiz_set.dart
│           ├── quiz.dart
│           └── entities.dart (导出文件)
└── examples/
    └── entity_relationship_examples.dart (关联示例)
```

## 实体关系

### 1. FlashcardSet（闪卡集合）
- **字段**：
  - `id`: 唯一标识符
  - `title`: 标题
  - `description`: 描述（可选）
  - `flashcardIds`: 包含的闪卡ID列表
  - `userId`: 用户ID
  - `createdAt`, `updatedAt`: 时间戳
  - `metadata`: 元数据（可存储note id等）

### 2. Flashcard（闪卡）
- **字段**：
  - `id`: 唯一标识符
  - `setId`: **所属的FlashcardSet ID**
  - `question`: 问题
  - `answer`: 答案
  - `hint`: 提示（可选）
  - `difficulty`: 难度等级（easy/medium/hard）
  - `status`: 状态（active/archived/deleted）
  - `reviewCount`: 复习次数
  - `lastReviewedAt`, `nextReviewAt`: 复习时间
  - `userId`: 用户ID
  - `createdAt`, `updatedAt`: 时间戳
  - `metadata`: 元数据（可存储note id等）

### 3. QuizSet（测验集合）
- **字段**：
  - `id`: 唯一标识符
  - `title`: 标题
  - `description`: 描述（可选）
  - `type`: 测验类型（多选/判断/填空/简答/混合）
  - `status`: 状态（draft/active/completed/archived/deleted）
  - `quizIds`: 包含的测验题ID列表
  - `timeLimit`: 时间限制（分钟）
  - `shuffleQuestions`: 是否打乱题目顺序
  - `showCorrectAnswers`: 是否显示正确答案
  - `userId`: 用户ID
  - `createdAt`, `updatedAt`: 时间戳
  - `metadata`: 元数据（可存储note id等）

### 4. Quiz（测验题）
- **字段**：
  - `id`: 唯一标识符
  - `setId`: **所属的QuizSet ID**
  - `question`: 问题
  - `type`: 题目类型（多选/判断/填空/简答）
  - `options`: 选择题选项列表（QuizOption对象）
  - `correctAnswer`: 正确答案（填空/简答）
  - `explanation`: 答案解释（可选）
  - `difficulty`: 难度等级（easy/medium/hard）
  - `status`: 状态（active/archived/deleted）
  - `points`: 题目分值
  - `userId`: 用户ID
  - `createdAt`, `updatedAt`: 时间戳
  - `metadata`: 元数据（可存储note id等）

## 与Note的关联方式

### 通过metadata字段建立关联：

1. **Note → FlashcardSet/QuizSet**:
   ```dart
   // 在Note的metadata中存储关联的集合ID
   metadata: {
     'associatedFlashcardSets': ['flashcard_set_1', 'flashcard_set_2'],
     'associatedQuizSets': ['quiz_set_1'],
   }
   ```

2. **FlashcardSet/QuizSet → Note**:
   ```dart
   // 在集合的metadata中存储源Note ID
   metadata: {
     'sourceNoteId': 'note_1',
     'autoGenerated': true,
   }
   ```

3. **Flashcard/Quiz → Note**:
   ```dart
   // 在具体题目的metadata中存储详细关联信息
   metadata: {
     'sourceNoteId': 'note_1',
     'noteSection': 'chapter-1',
     'autoGenerated': true,
   }
   ```

## 层级关系

```
Note (笔记)
├── FlashcardSet (闪卡集合)
│   ├── Flashcard (闪卡1)
│   ├── Flashcard (闪卡2)
│   └── ...
└── QuizSet (测验集合)
    ├── Quiz (测验题1)
    ├── Quiz (测验题2)
    └── ...
```

## 使用示例

详细的使用示例请参考：`lib/examples/entity_relationship_examples.dart`

该文件包含了：
- 如何创建带有关联信息的实体
- 如何通过metadata建立关联关系
- 辅助查询方法的实现

## 特性

1. **完整的CRUD支持**：所有实体都支持JSON序列化/反序列化
2. **类型安全**：使用枚举定义状态和类型
3. **扩展性**：metadata字段支持任意扩展数据
4. **关联灵活性**：支持双向关联和多对多关系
5. **时间追踪**：完整的创建和更新时间记录
6. **用户隔离**：每个实体都包含userId字段
